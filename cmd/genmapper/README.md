# genmapper - DTO to Entity Mapper Generator

This tool generates `ToEntity` and `FromEntity` methods for DTO structs, eliminating boilerplate code.

## Usage

The generator is automatically invoked via `go generate` directive in `internal/application/dto/mapper_base.go`:

```go
//go:generate go run github.com/atumaikin/nexflow/cmd/genmapper user_dto.go session_dto.go message_dto.go task_dto.go skill_dto.go schedule_dto.go
```

To regenerate mappers:

```bash
go generate ./internal/application/dto/mapper_base.go
```

## How It Works

1. Parses DTO struct definitions (e.g., `UserDTO`, `SessionDTO`)
2. Generates `ToEntity()` method on DTO that converts to Entity
3. Generates `FromEntity()` function that converts Entity to DTO
4. Handles field type mappings:
   - `string` ↔ `valueobject.Type` with MustNew constructors
   - `string` ↔ `time.Time` with RFC3339 formatting
   - Direct copy for `string` and `bool` fields

## Supported Mappings

### DTO (string) → Entity

| Field Type | Entity Type | Constructor |
|------------|-------------|--------------|
| ID | valueobject.UserID | valueobject.UserID() |
| Channel | valueobject.Channel | valueobject.MustNewChannel() |
| Role | valueobject.MessageRole | valueobject.MustNewMessageRole() |
| Status | valueobject.TaskStatus | valueobject.MustNewTaskStatus() |
| Version | valueobject.Version | valueobject.MustNewVersion() |
| CronExpression | valueobject.CronExpression | valueobject.MustNewCronExpression() |
| *ID fields | valueobject.*ID | valueobject.MustNew*ID() |
| CreatedAt | time.Time | MustParseTimeFields() |
| UpdatedAt | time.Time | MustParseTimeFieldsWithUpdatedAt() |

### Entity → DTO (string)

| Entity Type | DTO Type | Conversion |
|-------------|----------|------------|
| valueobject.Type | string | string(valueobject.Type) |
| time.Time | string | time.Format(time.RFC3339) |
| bool, string | same | Direct copy |

## Adding New DTOs

1. Create new DTO struct in `internal/application/dto/*_dto.go`
2. Ensure field names match entity field names
3. Add DTO file to `go:generate` directive in `mapper_base.go`
4. Run `go generate ./internal/application/dto/mapper_base.go`

## Generated Code Location

- File: `internal/application/dto/mapper_gen.go`
- Comment: `// Code generated by genmapper; DO NOT EDIT.`
