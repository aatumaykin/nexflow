# Руководство по Workspace для Nexflow

## Обзор

Nexflow использует **workspace-based** систему для управления личностью агента, контекстом пользователя и памятью. Workspace автоматически загружается и инжектируется в контекст агента в начале каждой сессии.

## Расположение Workspace

По умолчанию: `~/nexflow`

Можно настроить через переменную окружения:
```bash
export NEXFLOW_WORKSPACE="/custom/path/to/workspace"
```

Или в конфигурации:
```yaml
agents:
  defaults:
    workspace: "${NEXFLOW_WORKSPACE:~/nexflow}"
```

## Bootstrap файлы

Эти файлы определяют кто такой агент, кому он помогает и как себя ведёт.

### SOUL.md - Личность агента
Определяет личность агента, границы и основные истины.

**Содержимое:**
- Основные истины (как себя вести)
- Личность (имя, эмодзи)
- Границы (что делать/не делать)
- Тон (стиль общения)

**Когда обновляется:** Скажите пользователю — это душа агента, и он должен знать об этом.

### USER.md - Профиль пользователя
Определяет кому агент помогает.

**Содержимое:**
- Имя пользователя
- Как к нему обращаться
- Местоимения
- Часовой пояс
- Контекст (проекты, предпочтения)

**Цель:** Чем больше знает агент, тем лучше может помочь.

### AGENTS.md - Инструкции агента
Определяет как агент работает и управляет памятью.

**Содержимое:**
- Рутина запуска сессии (какие файлы читать)
- Управление памятью (ежедневные vs долговременная)
- Правила безопасности
- Внешние vs внутренние действия

**Ключевое правило:** "Текст > Мозг" — записывайте вещи, не полагайтесь на мысленные заметки.

### NOTES.md - Локальный контекст
Содержит информацию специфичную для окружения, которой нет в коде.

**Примеры:**
- Имена камер и расположения
- SSH хосты и алиасы
- Настройки голоса TTS
- Никнеймы устройств

**Цель:** Хранит локальный контекст отдельно от документации навыков.

## Система памяти

### Ежедневные логи: `memory/YYYY-MM-DD.md`
- Сырые, нефильтрованные логи происходящего каждый день
- Создаются автоматически
- Используются для недавнего контекста (сегодня + вчера)
- Расположение: `memory/` директория в workspace

### Долговременная память: `memory/memory.md`
- Отфильтрованные воспоминания и решения
- Загружается **только в основной сессии** (прямой чат)
- НЕ загружается в группах или общих контекстах
- Периодически обновляется из ежедневных логов

## Типы сессий

### Основная сессия
- Прямой чат с человеком
- **Загружает:** SOUL.md, USER.md, NOTES.md, MEMORY.md, ежедневные логи
- Может читать/писать все файлы памяти

### Другие сессии
- Групповые чаты, общие контексты
- **Загружает:** SOUL.md, USER.md, NOTES.md, ежедневные логи
- **НЕ загружает MEMORY.md** (безопасность)

## Конфигурация

### Отключить загрузку bootstrap
```yaml
agents:
  defaults:
    skip_bootstrap: true
```
Полезно для предварительно созданных workspace.

### Лимиты размера файлов
```yaml
agents:
  defaults:
    bootstrap_max_chars: 20000
```
Файлы больше этого размера обрезаются.

### Путь к workspace
```bash
# По умолчанию
export NEXFLOW_WORKSPACE=""

# Кастомный
export NEXFLOW_WORKSPACE="/path/to/workspace"

# Или в конфиге
agents:
  defaults:
    workspace: "${NEXFLOW_WORKSPACE:~/nexflow}"
```

## Начальная настройка

Запустите мастера настройки:
```bash
nexflow setup
```

Это создаст workspace с шаблонами и проведёт вас через начальную конфигурацию.

**Вопросы мастера настройки:**
1. Путь к workspace (или использовать дефолтный `~/nexflow`)
2. Имя пользователя
3. Как к нему обращаться
4. Часовой пояс
5. Имя агента
6. Эмодзи агента

Мастер настроек:
- Создаст структуру директорий workspace
- Сгенерирует bootstrap файлы из шаблонов
- Создаст директорию `memory/`
- Инициализирует пустой `memory/memory.md`
- Создаст пустой `NOTES.md` готовый к вашим локальным заметкам
