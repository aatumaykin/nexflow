# Руководство по системе памяти для Nexflow

## Обзор

Nexflow использует **гибридную систему памяти** объединяющую:
- Ежедневные логи в Markdown
- Долговременная отфильтрованная память
- Автоматический контекст сессии
- (v1.0+) Heartbeats для проактивного обновления памяти

## Ежедневные логи: `memory/YYYY-MM-DD.md`

### Назначение
Сырые, нефильтрованные логи происходящего каждый день.

### Когда использовать
- Запись событий по мере их происходения
- Логирование принятых решений
- Запись бесед или задач

### Формат
Свободный формат Markdown:
```markdown
# 2026-01-30

## Утро
Пользователь спросил о деплое проекта X. Обсуждали стратегию деплоя с Vercel.

## День
Решили использовать Railway вместо. Ключевые факторы: стоимость, простота настройки, автоматический SSL.

## Вечер
Обновили NOTES.md с новой структурой проекта.
```

### Автоматическая загрузка
- **Сегодня** и **вчера** файлы загружаются в контекст
- Файлы создаются автоматически если не существуют
- Расположение: `memory/` директория в workspace

## Долговременная память: `memory/memory.md`

### Назначение
Отфильтрованная суть, которую стоит хранить надолго.

### Что сюда помещать
- **Решения** (например, "Использовать Railway для проекта X")
- **Предпочтения** (например, "Предпочитать голос Nova для TTS")
- **Извлеченные уроки** (например, "Всегда тестировать деплои до 17:00")
- **Важный контекст** (например, "Пользователь работает в компании X над проектом Y")
- **Открытые циклы** (например, "Нужно решить между A и B")

### Чего НЕ должно быть здесь
- Секреты (если явно не просили их хранить)
- Тривиальные ежедневные события
- Временная информация
- Дубликаты

### Правило безопасности
**MEMORY.md загружается ТОЛЬКО в основной сессии** (прямой чат).

**НЕ загружается в:**
- Групповые чаты
- Общие контексты
- Сессии с другими людьми

Это предотвращает утечку личной информации к незнакомцам.

## Синтез памяти (v1.0+)

Когда включены heartbeats, агент периодически:
1. Читает последние `memory/YYYY-MM-DD.md` файлы
2. Идентифицирует значимые события, уроки или инсайты
3. Обновляет `memory/memory.md` с отфильтрованной сутью
4. Удаляет устаревшую информацию из memory.md

## Правило "Текст > Мозг"

**Критически:** Память агента ограничена между сессиями. Если вы хотите что-то запомнить:
- **ЗАПИШИТЕ ЭТО В ФАЙЛ** (`memory/YYYY-MM-DD.md` или `memory/memory.md`)
- НЕ полагайтесь на "мысленные заметки" — они не переживают перезапуска сессии

## Пример рабочего процесса

### Во время сессии:
```bash
Пользователь: "Запомни использовать Railway для проекта X"
Агент: [Обновляет memory/2026-01-30.md с решением]
```

### В конце дня:
```bash
Пользователь: "Подведи итоги дня"
Агент: [Читает memory/2026-01-30.md]
Агент: [Обновляет memory/memory.md с ключевыми решениями]
```

### В будущей сессии:
```bash
Агент: [Загружает memory/memory.md]
Агент: "На основе прошлых решений вы предпочитаете Railway для деплоя проектов X. Использовать сейчас?"
```

## Лучшие практики

1. **Пишите сразу** — Не ждите "потом"
2. **Будьте конкретными** — Зафиксируйте контекст, а не только выводы
3. **Обновляйте регулярно** — Просматривайте и удаляйте устаревшую информацию
4. **Уважайте безопасность** — Не загружайте личную память в общих контекстах
5. **Отфильтровывайте мудро** — MEMORY.md должна быть отфильтрованной сутью, а не сырыми логами

## Конфигурация

Расположение памяти:
```yaml
agents:
  defaults:
    workspace: "${NEXFLOW_WORKSPACE:~/nexflow}"
```

Отключить загрузку памяти:
```yaml
agents:
  defaults:
    skip_bootstrap: true
```
